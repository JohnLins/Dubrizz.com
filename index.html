<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="icon" type="image/x-icon" href="dubrizz.png">

    <title>Dubrizz AI</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f5f5f5;
            font-family: Arial, sans-serif;
        }
        .container {
            padding: 30px;
            text-align: center;
            width: 90%;
            max-width: 600px;
        }
        textarea {
            width: 100%;
            padding: 15px; /* Increased padding */
            box-sizing: border-box;
            border: none;
            border-radius: 15px;
            margin-bottom: 15px; 
            font-size: 18px; 
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1); 
            height: 250px;
            resize: vertical;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        button {
            background-color: white;
            color: lightcoral;
            border: none;
            border-radius: 5px;
            padding: 12px 20px; /* Adjusted padding */
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        button:hover {
            background-color: #ffe4e1;
        }
      #respondButton{
        width: 100%;
      }
        .response {
            margin-top: 20px;
            text-align: left;
            padding: 10px 15px;
            border-radius: 18px 18px 18px 0;
            background-color: #007AFF;
            color: white;
            display: inline-block;
        }
        #responseContainer {
            max-height: 400px; 
            overflow-y: auto; 
            overflow-x: hidden; 
            /*border: 1px solid black; */
            padding: 1px; 
        }

        .animate {
            animation: pop 0.3s ease-in-out;
        }
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }



         .custom-file-upload {
            display: inline-block;
            padding: 10px 20px;
            cursor: pointer;
            background-color: white;
            color: lightcoral;
            transition: background-color 0.3s;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .custom-file-upload:hover {
            background-color: #ffe4e1;

        }

        #imageInput {
            display: none;
        }

        #preview {
            max-width: 300px;
            display: none;
            margin-top: 10px;
        }
    </style>
</head>
<body>
<div id="user" style="position:fixed; top: 20px; right: 20px">

<button id="google-login-btn">
  <div class="gsi-material-button-state"></div>
  <div class="gsi-material-button-content-wrapper">
    <div class="gsi-material-button-icon">
      <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" xmlns:xlink="http://www.w3.org/1999/xlink" style="display: block;">
        <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path>
        <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path>
        <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path>
        <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path>
        <path fill="none" d="M0 0h48v48H0z"></path>
      </svg>
    </div>
    <span class="gsi-material-button-contents">Sign in with Google</span>
    <span style="display: none;">Sign in with Google</span>
  </div>
</button>






</div>


<style>
#google-login-btn {
  -moz-user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
  -webkit-appearance: none;
  background-color: WHITE;
  background-image: none;
  border: 1px solid #747775;
  -webkit-border-radius: 4px;
  border-radius: 4px;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  color: #1f1f1f;
  cursor: pointer;
  font-family: 'Roboto', arial, sans-serif;
  font-size: 14px;
  height: 40px;
  letter-spacing: 0.25px;
  outline: none;
  overflow: hidden;
  padding: 0 12px;
  position: relative;
  text-align: center;
  -webkit-transition: background-color .218s, border-color .218s, box-shadow .218s;
  transition: background-color .218s, border-color .218s, box-shadow .218s;
  vertical-align: middle;
  white-space: nowrap;
  width: auto;
  max-width: 400px;
  min-width: min-content;
}

#google-login-btn .gsi-material-button-icon {
  height: 20px;
  margin-right: 12px;
  min-width: 20px;
  width: 20px;
}

#google-login-btn .gsi-material-button-content-wrapper {
  -webkit-align-items: center;
  align-items: center;
  display: flex;
  -webkit-flex-direction: row;
  flex-direction: row;
  -webkit-flex-wrap: nowrap;
  flex-wrap: nowrap;
  height: 100%;
  justify-content: space-between;
  position: relative;
  width: 100%;
}

#google-login-btn .gsi-material-button-contents {
  -webkit-flex-grow: 1;
  flex-grow: 1;
  font-family: 'Roboto', arial, sans-serif;
  font-weight: 500;
  overflow: hidden;
  text-overflow: ellipsis;
  vertical-align: top;
}

#google-login-btn .gsi-material-button-state {
  -webkit-transition: opacity .218s;
  transition: opacity .218s;
  bottom: 0;
  left: 0;
  opacity: 0;
  position: absolute;
  right: 0;
  top: 0;
}

#google-login-btn:disabled {
  cursor: default;
  background-color: #ffffff61;
  border-color: #1f1f1f1f;
}

#google-login-btn:disabled .gsi-material-button-contents {
  opacity: 38%;
}

#google-login-btn:disabled .gsi-material-button-icon {
  opacity: 38%;
}

#google-login-btn:not(:disabled):active .gsi-material-button-state,
#google-login-btn:not(:disabled):focus .gsi-material-button-state {
  background-color: #303030;
  opacity: 12%;
}

#google-login-btn:not(:disabled):hover {
  -webkit-box-shadow: 0 1px 2px 0 rgba(60, 64, 67, .30), 0 1px 3px 1px rgba(60, 64, 67, .15);
  box-shadow: 0 1px 2px 0 rgba(60, 64, 67, .30), 0 1px 3px 1px rgba(60, 64, 67, .15);
}

#google-login-btn:not(:disabled):hover .gsi-material-button-state {
  background-color: #303030;
  opacity: 8%;
}

</style>



    <div class="container">
    <img src="dubrizz.png" height="60px" style="margin-bottom: -50px"/>
        <h1>Dubrizz AI</h1>
        <!--<h6>the nonchalant rizzler</h6>-->
        <textarea id="inputField" placeholder="Paste conversation history and context (more context = better rizz)...

Context: include extra context like this
Her: wyd
Me: testing dubrizz
Me: your input should follow this format
Her: what
"></textarea>
        <br/>
        
        
        <label for="imageInput" class="custom-file-upload">
        ðŸ“· upload screenshot of chat or profile
        </label>
        <input type="file" id="imageInput" accept="image/*">
        <br/><br/><br/>
        <button id="respondButton">respond</button>
        <div id="responseContainer" ></div>
    </div>






    <script type="module">
      let userId;
let userName;

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, setPersistence, browserLocalPersistence, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-analytics.js";

// Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyDcixgwxGbBvBKWpVw0XJYzzhmeXpp3FBU",
  authDomain: "dubrizz.firebaseapp.com",
  projectId: "dubrizz",
  storageBucket: "dubrizz.appspot.com",
  messagingSenderId: "376279827690",
  appId: "1:376279827690:web:529761e9563dbab4200393",
  measurementId: "G-GTBN0VJ4GN"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
auth.languageCode = 'en';
const provider = new GoogleAuthProvider();
const analytics = getAnalytics(app);

// Set local persistence to keep user signed in across sessions
function signin() {
  setPersistence(auth, browserLocalPersistence)
    .then(() => {
      return signInWithPopup(auth, provider);
    })
    .then((result) => {
      const user = result.user;
      userId = user.uid;
      userName = user.displayName;

      const userDiv = document.getElementById('user');
      const googleLoginBtn = document.getElementById('google-login-btn');
      googleLoginBtn.style.display = 'none';

      const userNameSpan = document.createElement('span');
      userNameSpan.textContent = userName;
      userDiv.appendChild(userNameSpan);
    })
    .catch((error) => {
      console.error("Error signing in:", error);
    });
}

// Detect and display user on page load if they're already signed in
onAuthStateChanged(auth, (user) => {
  if (user) {
    userId = user.uid;
    userName = user.displayName;

    const userDiv = document.getElementById('user');
    const googleLoginBtn = document.getElementById('google-login-btn');
    googleLoginBtn.style.display = 'none';

    const userNameSpan = document.createElement('span');
    userNameSpan.textContent = userName;
    userDiv.appendChild(userNameSpan);
  }
});

// Event listener for the login button
const googleLogin = document.getElementById("google-login-btn");
googleLogin.addEventListener("click", function() {
  signin();
});



    /////////////////////////////////////////

        const imgInput = document.getElementById('imageInput');
        imgInput.addEventListener('change', function(event) {
        if (userId === undefined) {
                console.error("User is not logged in.");
                signin();
            }


            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const base64String = e.target.result.split(',')[1]; // Get only the base64 part

                    

                    fetch('https://dubrizz-production.up.railway.app/ss', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ base: base64String, id: userId })
                    })
                    .then(response => response.json())
                    .then(d => {
                      document.getElementById('inputField').value = d.choices[0].message.content
                        console.log('Success:', d);
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    
                    });


                    
                    
                };
                reader.readAsDataURL(file);
            }

        });




        
        const respondButton = document.getElementById('respondButton');
        const inputField = document.getElementById('inputField');
        const responseContainer = document.getElementById('responseContainer');
        let responseState = "respond";

        respondButton.addEventListener('click', async () => {

            respondButton.textContent = "...";
            respondButton.disabled = true;

            if (userId === undefined) {
                console.error("User is not logged in.");
                signin();
                document.getElementById('respondButton').disabled = false;
                document.getElementById('respondButton').textContent = "again";
            }


            const history = inputField.value.trim();

            if (history !== "") {
                try {
                    const response = await fetch(`https://dubrizz-production.up.railway.app/rizz?history=${encodeURIComponent(history)}&id=${encodeURIComponent(userId)}`);



                    if (response.status === 401) {
                        console.error("User is not logged in.");
                        signin();

                    }

                    const data = await response.json();

                    const newResponse = document.createElement('div');
                    const obj = JSON.parse(data.response);
                    
                    
                    let content = "";
                    obj.responses.forEach(response => {
                      content += `<div class="response">${response}</div><br/>`;
                    });
                  
                    newResponse.innerHTML = content; 


                    
                    //window.alert(obj.responses)
                   
                    
                    newResponse.classList.add('animate');
                    responseContainer.prepend(newResponse);


                    document.getElementById('respondButton').disabled = false;
                    document.getElementById('respondButton').textContent = "again";
                } catch (error) {
                    console.error('Error fetching the response:', error);



                    // const fallbackResponse = document.createElement('div');
                    // fallbackResponse.textContent = "ERROR";
                    // fallbackResponse.classList.add('animate');
                    // responseContainer.prepend(fallbackResponse);



                }
            }

            if (responseState === "respond") {
                respondButton.textContent = "another";
                responseState = "another";
            }
        });

        inputField.addEventListener('input', () => {
            respondButton.textContent = "respond";
            responseState = "respond";
        });
    </script>





</body>
</html>
